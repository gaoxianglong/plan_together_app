# Maiden Plan - Flutter 前端项目结构

## 项目概述

基于 PRD v2.0 文档实现的"做计划"模块 Flutter 前端界面，采用 Minimal Peach 主题设计。

## 目录结构

```
lib/
├── main.dart                          # 应用入口
├── config/
│   └── api_config.dart                # API 配置文件（Base URL、超时等）
├── models/
│   └── task.dart                      # 任务数据模型（Task、SubTask、枚举类型）
├── pages/
│   ├── focus/
│   │   └── focus_page.dart           # 专注页面（番茄钟）
│   ├── main/
│   │   └── main_page.dart            # 主页面（包含底部导航和页面切换）
│   ├── plan/
│   │   └── plan_page.dart            # 做计划页面（核心页面）
│   └── statistics/
│       └── statistics_page.dart      # 统计页面（视图模块）
├── theme/
│   ├── app_colors.dart               # 颜色配置（Minimal Peach 主题）
│   └── app_theme.dart                # Material 主题配置
└── widgets/
    ├── calendar/
    │   └── week_calendar.dart        # 周日历组件（支持滑动切换、日期选择）
    ├── common/
    │   ├── app_bottom_nav.dart       # 底部导航栏组件（含小猫动画）
    │   ├── cat_animation.dart        # 小猫动画组件（趴在按钮上）
    │   ├── empty_state.dart          # 空状态组件（无任务、网络错误等）
    │   ├── plan_header.dart          # 做计划页面头部组件
    │   └── quote_card.dart           # 励志名言卡片组件
    ├── task/
    │   ├── add_subtask_sheet.dart    # 新增子任务浮层组件
    │   ├── add_task_sheet.dart       # 新增任务浮层组件
    │   ├── edit_task_sheet.dart      # 编辑任务浮层组件
    │   ├── eisenhower_matrix.dart    # 艾森豪威尔四象限矩阵组件
    │   ├── priority_section.dart     # 单个优先级区块组件
    │   ├── subtask_list_sheet.dart   # 子任务列表浮层组件
    │   └── task_card.dart            # 任务卡片组件
    └── widgets.dart                   # 组件统一导出文件
```

## 资源目录

```
assets/
├── images/
│   └── Pomodoro.svg              # 番茄钟SVG图标
├── celebrations.json             # 庆祝文案配置
└── quotes.json                   # 励志名言配置
```

## 已实现的功能界面

### 1. 做计划页面 (`plan_page.dart`)

| 功能 | 描述 | 状态 |
|------|------|------|
| 页面头部 | 标题"Daily Planner"、主题标识、设置按钮 | ✅ 完成 |
| 周日历 | 支持左右滑动切换周、点击选择日期、显示任务指示点 | ✅ 完成 |
| 返回今天按钮 | 非今日时显示，点击切换到今天 | ✅ 完成 |
| 四象限任务列表 | P0~P3 四个象限的 2x2 网格布局 | ✅ 完成 |
| 励志名言卡片 | 带装饰性斜线条纹的名言展示 | ✅ 完成 |
| 浮动添加按钮 | 点击新增任务，长按快速选择优先级 | ✅ 完成 |

### 2. 任务相关组件

| 组件 | 描述 | 状态 |
|------|------|------|
| 任务卡片 | 显示任务标题、勾选按钮、子任务进度、重复标识 | ✅ 完成 |
| 新增任务浮层 | 标题输入、象限选择、重复设置（每日/每周/每月） | ✅ 完成 |
| 新增子任务浮层 | 继承父任务信息，支持独立重复设置 | ✅ 完成 |
| 编辑任务浮层 | 修改标题/日期/优先级/重复设置、删除任务 | ✅ 完成 |

### 3. 日历组件

| 功能 | 描述 | 状态 |
|------|------|------|
| 周视图 | 显示一周七天 | ✅ 完成 |
| 月份标题 | 显示当前月份年份 | ✅ 完成 |
| 左右导航 | 切换上一周/下一周 | ✅ 完成 |
| 日期选择 | 点击选中日期高亮 | ✅ 完成 |
| 今日标识 | 今日日期特殊颜色标记 | ✅ 完成 |
| 任务指示点 | 显示各优先级未完成任务的彩色圆点 | ✅ 完成 |

### 4. 底部导航

| Tab | 描述 | 状态 |
|-----|------|------|
| 做计划 | 主页面，已实现完整界面 | ✅ 完成 |
| 视图 | 统计页面，支持周/月视图切换 | ✅ 完成 |
| 专注 | 番茄钟倒计时页面 | ✅ 完成 |
| 我的 | 坚持天数显示、音效开关、设备管理 | ✅ 完成 |

## 主题配色（Minimal Peach）

| 颜色用途 | 颜色值 | 说明 |
|----------|--------|------|
| 主色 | `#E91E63` | 玫红色 |
| 主色浅 | `#F8BBD9` | 浅粉色 |
| 背景色 | `#FFF5F5` | 淡粉色背景 |
| P0 优先级 | `#E91E63` | 紧急且重要 - 玫红 |
| P1 优先级 | `#FF9800` | 重要不紧急 - 橙色 |
| P2 优先级 | `#FFEB3B` | 紧急不重要 - 黄色 |
| P3 优先级 | `#4CAF50` | 不重要不紧急 - 绿色 |

## 数据模型

### Task（任务）

```dart
class Task {
  String id;
  String userId;
  String title;
  TaskPriority priority;    // P0/P1/P2/P3
  DateTime date;            // 归属日期
  TaskStatus status;        // 未完成/已完成
  List<SubTask> subTasks;   // 子任务列表
  RepeatType repeatType;    // 重复类型
  // ...
}
```

### SubTask（子任务）

```dart
class SubTask {
  String id;
  String parentId;
  String title;
  TaskStatus status;
  RepeatType repeatType;
  // ...
}
```

### 枚举类型

- `TaskPriority`: P0、P1、P2、P3
- `TaskStatus`: incomplete、completed
- `RepeatType`: none、daily、weekly、monthly

## 待实现的业务逻辑

代码中用 `// TODO` 标记了需要后续实现的业务逻辑：

1. 任务的增删改查 API 调用
2. 任务完成状态切换
3. 子任务完成状态切换及父任务联动
4. 本地数据持久化
5. 网络同步
6. 打卡功能
7. 视图/专注/我的模块

## 运行项目

```bash
cd plan_together_app
flutter pub get
flutter run
```

## 修复记录

| 日期 | 文件 | 问题 | 修复 |
|------|------|------|------|
| 2026-01-28 | `app_theme.dart` | `CardTheme` 类型错误 | 改为 `CardThemeData` |
| 2026-01-28 | `plan_page.dart` | `withOpacity` 已废弃 | 改为 `withValues(alpha:)` |
| 2026-01-28 | `week_calendar.dart` | 应使用 `SizedBox` | `Container` 改为 `SizedBox` |
| 2026-01-28 | `empty_state.dart` | `withOpacity` 已废弃 | 改为 `withValues(alpha:)` |
| 2026-01-28 | `quote_card.dart` | `withOpacity` 已废弃 | 改为 `withValues(alpha:)` |
| 2026-01-28 | `add_task_sheet.dart` | `activeColor` 已废弃 | 改为 `activeTrackColor` |
| 2026-01-28 | `add_subtask_sheet.dart` | `activeColor` 已废弃 | 改为 `activeTrackColor` |
| 2026-01-28 | `edit_task_sheet.dart` | `activeColor` 已废弃 | 改为 `activeTrackColor` |
| 2026-01-28 | `widgets.dart` | 不必要的 `library` 声明 | 移除 library 声明 |
| 2026-01-28 | `widget_test.dart` | 引用已删除的 `MyApp` 类 | 改为 `PlanTogetherApp` |
| 2026-01-28 | `app_bottom_nav.dart` | 布局调整 | 添加中间"+"按钮，与导航栏集成 |
| 2026-01-28 | `week_calendar.dart` | 布局调整 | 压缩高度（80→64），减少间距 |
| 2026-01-28 | `plan_header.dart` | 布局调整 | 压缩高度，减少padding |
| 2026-01-28 | `quote_card.dart` | 布局调整 | 压缩高度（120→80） |
| 2026-01-28 | `plan_page.dart` | 布局调整 | 移除浮动按钮，减少间距，一屏显示 |
| 2026-01-28 | `main_page.dart` | 功能增强 | 通过GlobalKey连接底部按钮与PlanPage |
| 2026-01-28 | `week_calendar.dart` | 指示器被遮挡 | 移除Stack+Positioned，改为Column布局，高度72 |
| 2026-01-28 | `task_card.dart` | 字体过大/长文本换行 | 主任务字体15→12，单行省略ellipsis，checkbox 22→16 |
| 2026-01-28 | `priority_section.dart` | 布局优化 | padding 16→10，标题字体13→10，圆角16→12 |
| 2026-01-28 | `eisenhower_matrix.dart` | 布局优化 | 标题字体13→11，间距12→8 |
| 2026-01-28 | `priority_section.dart` | 固定高度 | 添加height参数(默认120)，任务列表改用ListView可滚动 |
| 2026-01-28 | `priority_section.dart` | 高度调整 | 默认高度 120→140 |
| 2026-01-28 | `quote_card.dart` | 高度调整 | 高度 80→100，字体 13→14，maxLines 2→3 |
| 2026-01-28 | `priority_section.dart` | 高度再调整 | 默认高度 140→160 |
| 2026-01-28 | `quote_card.dart` | 高度再调整 | 高度 100→120 |
| 2026-01-28 | `quotes_data.dart` | 新增 | 创建100条励志中文短文数据 |
| 2026-01-28 | `quote_service.dart` | 新增 | 励志名言服务，30分钟自动刷新 |
| 2026-01-28 | `main.dart` | 功能增强 | 启动时初始化QuoteService |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 监听quoteStream动态更新名言 |
| 2026-01-28 | `quotes_data.dart` | 删除 | 移除硬编码数据 |
| 2026-01-28 | `assets/quotes.json` | 新增 | 100条英文励志短文配置文件 |
| 2026-01-28 | `quote_service.dart` | 重构 | 从JSON加载名言，移除author支持 |
| 2026-01-28 | `quote_card.dart` | 重构 | 移除author参数，简化布局 |
| 2026-01-28 | `plan_page.dart` | 重构 | 适配String类型的quote |
| 2026-01-28 | `pubspec.yaml` | 配置 | 添加assets/quotes.json |
| 2026-01-28 | `plan_page.dart` | 间距优化 | 返回今天按钮到四象限间距 18px→9px |
| 2026-01-28 | `plan_page.dart` | 间距优化 | 返回今天按钮到四象限间距 9px→4px |
| 2026-01-28 | `week_calendar.dart` | BUG修复 | 修复返回今天后指示器消失问题，添加didUpdateWidget |
| 2026-01-28 | `week_calendar.dart` | BUG修复 | 月份显示：选中日期在当前周时显示选中月份，否则显示周四月份 |
| 2026-01-28 | `task_card.dart` | 功能增强 | 添加任务完成状态切换动画（200ms），圆圈+文字过渡 |
| 2026-01-28 | `plan_page.dart` | 功能实现 | 实现_handleToggleTaskComplete和_handleToggleSubTaskComplete状态切换 |
| 2026-01-28 | `confetti_animation.dart` | 新增 | 礼花粒子动画组件（CustomPainter实现，120粒子） |
| 2026-01-28 | `celebration_overlay.dart` | 新增 | 庆祝弹窗组件（礼花+文案） |
| 2026-01-28 | `celebration_service.dart` | 新增 | 庆祝服务（持久化当天触发状态） |
| 2026-01-28 | `celebrations.json` | 新增 | 15条随机庆祝文案 |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 集成当日全完成庆祝动画逻辑 |
| 2026-01-28 | `pubspec.yaml` | 依赖 | 添加shared_preferences持久化库 |
| 2026-01-28 | `app_colors.dart` | 样式调整 | 背景色改为柔和粉色，优先级颜色P1-P3调整 |
| 2026-01-28 | `quote_card.dart` | 样式调整 | 文字颜色由灰色改为黑色，条纹增强 |
| 2026-01-28 | `add_task_sheet.dart` | 功能简化 | 移除"归属日期"显示字段，任务自动归属日历选中日期 |
| 2026-01-28 | `PRD_做计划APP_v2.0.md` | 文档更新 | 新增任务浮层移除"归属日期"字段说明 |
| 2026-01-28 | `add_task_sheet.dart` | 视觉升级 | 全英文化；"New Task"标题使用P0红色；输入框仅保留底部下划线（P0→P1渐变）；取消按钮改为右上角X按钮；保存按钮改为P0→P1渐变胶囊风格；Repeat开关使用P1粉色；象限使用P0~P3标签；月重复改为日历网格弹窗选择 |
| 2026-01-28 | `plan_page.dart` | 功能实现 | 实现前端任务创建逻辑：生成唯一ID、创建Task对象、添加到任务列表并刷新UI |
| 2026-01-28 | `priority_section.dart` | 功能增强 | 新增onSectionTap回调，支持点击象限空白区域触发快捷创建任务 |
| 2026-01-28 | `eisenhower_matrix.dart` | 功能增强 | 新增onQuadrantTap回调，将象限点击事件传递给父组件 |
| 2026-01-28 | `add_task_sheet.dart` | 交互优化 | 空任务名验证改为输入框震动动效+下方淡入错误提示，3秒后自动消失；输入时自动清除错误；下划线变红提示 |
| 2026-01-28 | 多文件 | 国际化 | 全部UI文字改为英文：底部导航(Plan/View/Focus/Me)、返回今天、快速创建任务、象限空态提示等 |
| 2026-01-28 | `task_card.dart` | 交互优化 | 移除循环任务🔁图标；左滑删除：ClipRect限制边界、删除按钮24x24px随滑动渐显（透明度+位移+缩放）、颜色跟随象限优先级、最大滑动32px |
| 2026-01-28 | `priority_section.dart` | 功能增强 | 新增onDeleteTask回调 |
| 2026-01-28 | `eisenhower_matrix.dart` | 功能增强 | 新增onDeleteTask回调 |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 新增_handleDeleteTask方法处理任务删除 |
| 2026-01-28 | `task.dart` | 英文化 | RepeatType枚举标签改为英文(Daily/Weekly/Monthly) |
| 2026-01-28 | `add_subtask_sheet.dart` | 新增 | 新增子任务浮层组件，复用主任务浮层样式；仅保留标题+输入+Save+X按钮；支持震动校验 |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 点击任务弹出子任务创建浮层；新增_handleAddSubtask方法将子任务添加到父任务 |
| 2026-01-28 | `add_subtask_sheet.dart` | 样式调整 | 移除父任务信息框；统一使用New Task浮层样式（P0红标题、P0→P1渐变下划线和按钮） |
| 2026-01-28 | `task_card.dart` | 布局重构 | 移除父任务下方的子任务列表；新增右侧子任务图标（显示完成数/总数）；图标跟随任务滑动；新增onShowSubtasks回调 |
| 2026-01-28 | `subtask_list_sheet.dart` | 新增 | 子任务列表浮层组件（空白占位，待填充内容） |
| 2026-01-28 | `priority_section.dart` | 功能增强 | 新增onShowSubtasks回调传递给TaskCard |
| 2026-01-28 | `eisenhower_matrix.dart` | 功能增强 | 新增onShowSubtasks回调传递给PrioritySection |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 新增_handleShowSubtasks方法弹出子任务列表浮层 |
| 2026-01-28 | `subtask_list_sheet.dart` | 功能实现 | 完整子任务列表：按createdAt倒序；右滑删除（限制在窗口内）；点击圆圈切换完成状态；显示父任务信息和进度 |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 子任务切换/删除回调；所有子任务完成时自动标记父任务完成；反之取消完成；新增_handleDeleteSubtask方法 |
| 2026-01-28 | `subtask_list_sheet.dart` | 布局优化 | 子任务列表固定高度280px，内容超出时支持滚动 |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 点击父任务圆圈时，同时切换所有子任务的完成状态 |
| 2026-01-28 | `subtask_list_sheet.dart` | 视觉优化 | 添加优先级标签(P0/P1/P2/P3)到标题旁；移除子任务项之间的分隔线；点击勾选不再关闭/重开浮层 |
| 2026-01-28 | `subtask_list_sheet.dart` | BUG修复 | 修复圆圈无法点击：1)扩大触控区域32x44px 2)滑动方向改为左滑删除 3)使用本地状态管理实现即时UI更新 |
| 2026-01-28 | `subtask_list_sheet.dart` | 样式优化 | 子任务浮层统一使用P0红色主题：标题/背景/列表/按钮/复选框均使用P0色，仅优先级徽章保留实际优先级颜色 |
| 2026-01-28 | `priority_section.dart` | 交互优化 | 象限任务列表支持滚动：使用AlwaysScrollableScrollPhysics确保任务多时可下滑 |
| 2026-01-28 | `add_subtask_sheet.dart` | 功能增强 | 新增可编辑父任务名称：在标题下方显示父任务名，点击可编辑，失焦或回车保存 |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 新增_handleUpdateTaskTitle方法处理父任务名称修改（仅前端） |
| 2026-01-28 | `subtask_list_sheet.dart` | 功能增强 | 子任务名称点击可编辑：添加编辑状态/TextEditingController/失焦保存逻辑/编辑图标 |
| 2026-01-28 | `plan_page.dart` | 功能增强 | 新增_handleUpdateSubtaskTitle方法处理子任务名称修改（仅前端） |
| 2026-01-28 | `PRD_做计划APP_v2.0.md` | 文档更新 | 同步前端交互变更：任务完成动画、左滑删除、子任务浮层、庆祝动效、励志名言、UI英文化、优先级颜色等 |
| 2026-01-28 | `add_subtask_sheet.dart` | BUG修复 | 父任务名称编辑的✓图标无响应：为图标添加GestureDetector点击处理 |
| 2026-01-28 | `add_subtask_sheet.dart` | 交互优化 | 点击其他区域自动保存父任务名称：保存按钮/关闭按钮/子任务输入框点击时自动完成编辑 |
| 2026-01-28 | `subtask_list_sheet.dart` | 交互优化 | 点击其他区域自动保存子任务名称：复选框/删除按钮点击时自动完成编辑 |
| 2026-01-29 | `subtask_list_sheet.dart` | 功能增强 | 在子任务列表底部新增"Add Subtask"按钮，支持从列表页直接添加子任务 |
| 2026-01-29 | `plan_page.dart` | 功能增强 | 实现子任务列表页"Add Subtask"回调，复用AddSubtaskSheet，并同步更新列表状态 |
| 2026-01-29 | `subtask_list_sheet.dart` | 交互优化 | 点击"Add Subtask"按钮时关闭列表浮层，通过回调唤起新增浮层 |
| 2026-01-29 | `focus_page.dart` | 新增 | 创建专注页面（Focus Module），实现番茄钟倒计时、暂停/继续/结束逻辑及UI |
| 2026-01-29 | `main_page.dart` | 功能增强 | 集成 FocusPage 到底部导航栏，替换原有的占位页面 |
| 2026-01-29 | `focus_page.dart` | 样式优化 | 倒计时字号调整(56->48)，优化set-time浮层(去边框/高亮色/字号)，标题色改用P0红 |
| 2026-01-29 | `focus_page.dart` | 布局调整 | 移除右上角更多按钮，历史记录按钮改为纯图标，标题居中 |
| 2026-01-29 | `focus_page.dart` | 功能增强 | 新增番茄钟计时呼吸动画效果（光晕扩散收缩） |
| 2026-01-29 | `pubspec.yaml` | 配置 | 新增 `assets/images/` 目录配置，用于存放矢量图等图片资源 |
| 2026-01-29 | `focus_page.dart` | UI升级 | 引入 `flutter_svg` 库，使用 `Pomodoro.svg` 替换标题中的 Emoji |
| 2026-01-29 | `focus_page.dart` | 样式优化 | 历史记录图标颜色改为 P0 红色，与主题保持一致 |
| 2026-01-29 | `focus_page.dart` | 功能增强 | 新增历史专注记录浮层：显示总专注时长、最长一次专注、专注次数统计 |
| 2026-01-29 | `focus_page.dart` | 样式优化 | 历史浮层标题使用P0颜色，Close按钮使用P0→P1渐变色（与添加子任务一致） |
| 2026-01-29 | `focus_page.dart` | 样式优化 | 历史专注浮层关闭按钮图标从✅改为⬇️ (Icons.keyboard_arrow_down_rounded) |
| 2026-01-29 | `focus_page.dart` | 样式优化 | 历史专注浮层中的统计数字颜色改为P0色 (AppColors.priorityP0) |
| 2026-01-29 | `focus_page.dart` | 样式优化 | 历史专注浮层布局优化：缩小间距、内边距和图标大小，使整体更紧凑 |
| 2026-01-29 | `focus_page.dart` | 样式优化 | set-time 浮层布局优化：缩小高度、间距和字体，使其更紧凑 |
| 2026-01-29 | `focus_page.dart` | 样式优化 | 统一浮层背景色为 AppColors.cardBackground (与历史记录浮层一致) |
| 2026-01-29 | `subtask_list_sheet.dart` | 样式优化 | 统一子任务列表浮层背景色为 AppColors.cardBackground，内部容器使用 AppColors.surfaceLight |
| 2026-01-29 | `focus_page.dart` | 功能实现 | 实现"Auto-start next round"功能：倒计时结束后自动开始下一轮；同时自动记录本次专注到历史 |
| 2026-01-30 | `statistics_page.dart` | 新增 | 创建统计页面：支持按象限/时间维度(周/月)过滤；展示任务完成率曲线图；展示分状态任务列表 |
| 2026-01-30 | `main_page.dart` | 功能增强 | 集成 StatisticsPage 到底部导航栏"View"标签页 |
| 2026-01-30 | `subtask_list_sheet.dart` | 样式优化 | 子任务列表布局紧凑化：高度280->220，Item高度44->36，减少间距 |
| 2026-01-30 | `subtask_list_sheet.dart` | 样式优化 | Add Subtask按钮样式升级：P0->P1渐变色胶囊按钮，白色文字图标，增加阴影 |
| 2026-01-30 | 多文件 | 样式统一 | 所有底部浮层(Task/Subtask/Focus)背景色统一为 `AppColors.cardBackground` |
| 2026-01-30 | `statistics_page.dart` | 布局优化 | 移除顶部Statistics标题和右上角日历图标；曲线图添加ClipRect裁剪阴影；整体组件上移减少间距 |
| 2026-01-30 | `statistics_page.dart` | 样式优化 | 任务列表字体与做计划页面统一(fontSize:12, fontWeight:w500)；增加各象限模拟数据确保All Tasks正常显示 |
| 2026-01-30 | `statistics_page.dart` | 样式优化 | 下拉选择器和Week/Month按钮尺寸压缩更紧凑；已完成任务图标改为P0红色 |
| 2026-01-30 | `cat_animation.dart` | 新增 | 创建趴在按钮上的小猫动画组件：呼吸起伏、尾巴低频摆动、按压压扁回弹效果 |
| 2026-01-30 | `app_bottom_nav.dart` | 功能增强 | 集成小猫动画到中间添加按钮顶部；改为StatefulWidget处理按压状态 |
| 2026-01-30 | `cat_animation.dart` | 样式优化 | 猫咪改为Minimal Peach粉色系配色；增大尺寸(56px)；爪子覆盖按钮并持续摇摆；添加腮红、内耳、肉垫细节 |
| 2026-01-30 | `cat_animation.dart` | 样式调整 | 移除爪子；增大猫咪尺寸(64px)；添加细黑线描边(0.8px)使轮廓更清晰 |
| 2026-01-30 | `cat_animation.dart` | 细节添加 | 猫咪脸部两侧各添加3根长胡须(0.6px细线) |
| 2026-01-30 | `cat_animation.dart` | 动画增强 | 胡须加长(1.1倍头部半径)；添加打哈欠动画(嘴巴张开+眼睛眯紧,每15-25秒随机触发) |
| 2026-01-30 | `plan_page.dart` | 样式优化 | Quick Add Task浮层重新设计：圆角卡片式选项、渐变优先级标识、粉色主题标题、统一边框和阴影 |
| 2026-01-30 | `plan_page.dart` | 布局压缩 | Quick Add浮层尺寸压缩：选项卡片padding/margin减小、字体缩小、优先级圆圈28px、整体更紧凑 |
| 2026-01-30 | `app_bottom_nav.dart` | 样式优化 | 调整小猫在导航栏的布局位置和大小，确保更好地贴合按钮 |
| 2026-01-30 | `plan_page.dart` | 交互优化 | Quick Add 浮层样式升级：移除底部 Cancel 按钮，添加右上角关闭按钮；调整拖动条样式与其他浮层统一；布局更紧凑 |
| 2026-01-30 | `login_page.dart` | 交互优化 | 登录失败时移除底部 SnackBar，改为输入框红线高亮提示（Border/Shadow/Text Color/Icon Color 变红），并在3秒后自动恢复或输入时恢复 |
| 2026-01-30 | `login_page.dart` | 文案修改 | 找回密码浮层文案更新：标题改为"Retrieve Password"；描述改为"Enter your email to retrieve your password."；按钮保持"Send" |
| 2026-01-30 | `login_page.dart` | 样式调整 | 错误提示时文本框保持原有外观，只显示错误提示条 |
| 2026-01-30 | 多文件 | 品牌更名 | APP名称从"Plan Together"改为"Maiden Plan"，更新main.dart/login_page.dart/widget_test.dart |
| 2026-01-30 | 多平台配置 | 品牌更新 | 修改iOS/Android应用显示名称为"Maiden Plan"；生成粉色猫咪图标替换默认图标 |
| 2026-01-30 | `draggable_cat.dart` | 新增 | 创建可拖动猫咪组件：支持拖动到屏幕任意位置，松手后弹性动画回到原位；拖动时睁开眼睛表情 |
| 2026-01-30 | `main_page.dart` | 功能增强 | 集成可拖动猫咪到全局Stack层；计算猫咪原始位置在底部导航栏上方 |
| 2026-01-30 | `app_bottom_nav.dart` | 结构调整 | 移除内嵌猫咪组件（改由MainPage管理可拖动猫咪） |
| 2026-01-31 | `assets/audio/` | 新增 | 创建音效资源目录，添加点击音效和翻页音效MP3文件 |
| 2026-01-31 | `audio_service.dart` | 新增 | 创建音频服务：管理点击音效(playClick)和翻页音效(playPageTurn)播放 |
| 2026-01-31 | `main_page.dart` | 功能增强 | 底部导航按钮点击时播放点击音效 |
| 2026-01-31 | `week_calendar.dart` | 功能增强 | 日历左右翻页和滑动时播放翻页音效 |
| 2026-01-31 | `plan_page.dart` | 功能增强 | "Back to Today"按钮和Quick Add浮层按钮添加音效 |
| 2026-01-31 | `audio_service.dart` | 功能增强 | 新增 playButton() 方法用于通用按钮音效(toy-button-105724.mp3) |
| 2026-01-31 | 多文件 | 音效集成 | 全局按钮音效集成：login/register/me/focus/statistics页面及所有task相关组件按钮添加toy-button音效 |
| 2026-01-31 | `audio_service.dart` | 功能增强 | 新增 playTimerComplete() 番茄钟完成音效和 playCelebration() 任务全部完成庆祝音效 |
| 2026-01-31 | `focus_page.dart` | 功能增强 | 番茄钟倒计时结束时播放 game-over 音效 |
| 2026-01-31 | `plan_page.dart` | 功能增强 | 当天四象限任务全部完成时播放 cute-silly-ya 庆祝音效 |
| 2026-01-31 | `celebration_overlay.dart` | 样式重构 | 庆祝浮层重新设计为 Minimal Peach 风格：粉色渐变背景、白色圆角卡片、渐变图标、浮动动画、心形装饰、点击关闭 |
| 2026-01-31 | `confetti_animation.dart` | 样式重构 | 礼花动画改为温柔飘落效果：粉色系配色、心形/圆形/星形粒子、缓慢飘落、轻微摆动 |
| 2026-01-31 | `plan_header.dart` | 功能增强 | 右上角设置按钮添加 onSettingsTap 回调支持 |
| 2026-01-31 | `plan_page.dart` | 功能增强 | 设置按钮点击导航到"我的"页面 |
| 2026-01-31 | `main_page.dart` | 功能增强 | 传递 onSettingsTap 回调给 PlanPage，实现跳转到 Me 页面 |
| 2026-01-31 | `me_page.dart` | 功能增强 | 新增"已坚持做计划N天"显示，N 使用 P0 玫红色标记 |
| 2026-01-31 | `me_page.dart` | 功能增强 | 新增音效开关设置，可开关所有提示音 |
| 2026-01-31 | `me_page.dart` | 功能增强 | 新增设备管理浮层：显示登录设备列表(3/10)、当前设备标记、非当前设备可退出登录 |
| 2026-01-31 | `register_page.dart` | BUG修复 | 修复编译错误：移除不存在的app_text_styles.dart导入；修正AuthService.register调用为实例方法；替换不存在的AppColors属性 |
| 2026-01-31 | `me_page.dart` | 样式调整 | Sound Effects开关尺寸调整(28x48)，与其他菜单项高度一致 |
| 2026-01-31 | `avatar_service.dart` | 新增 | 创建头像服务：管理用户头像选择和持久化，提供10个预设头像，支持Stream监听变化 |
| 2026-01-31 | `pubspec.yaml` | 配置 | 添加 assets/images/avatars/ 目录配置 |
| 2026-01-31 | `main.dart` | 功能增强 | 初始化 AvatarService |
| 2026-01-31 | `me_page.dart` | 功能增强 | 头像可点击弹出选择浮层；5列网格显示头像；选中头像有高亮边框 |
| 2026-01-31 | `plan_header.dart` | 功能增强 | 左上角昵称旁显示圆形头像(48x48)，带粉色边框和阴影 |
| 2026-01-31 | `plan_page.dart` | 功能增强 | 监听头像变化并传递给PlanHeader；昵称改为"JohnGao" |
| 2026-01-31 | `avatar_service.dart` | 功能增强 | 设置默认头像(avatar26.svg)，selectedAvatar始终返回有效值 |
| 2026-01-31 | `me_page.dart` | 结构重构 | 菜单分组：Account区(修改密码+退出登录)、Settings区(音效开关+设备管理)；使用分组卡片样式 |
| 2026-01-31 | `me_page.dart` | 功能增强 | 新增修改密码浮层：当前密码/新密码/确认密码输入；密码可见切换；验证逻辑；P0→P1渐变按钮风格 |
| 2026-01-31 | `main.dart` | 交互调整 | APP启动始终进入登录页，移除登录状态检查（仅前端交互，不涉及后端存储） |
| 2026-01-31 | `avatar_service.dart` | 功能增强 | 扩展头像列表从10个到20个(avatar21-avatar40) |
| 2026-01-31 | `me_page.dart` | 功能增强 | 头像选择浮层支持滚动，高度设为屏幕50%，可容纳20个头像 |
| 2026-01-31 | `nickname_service.dart` | 新增 | 创建昵称服务：管理用户昵称持久化，默认"JohnGao"，支持Stream监听变化 |
| 2026-01-31 | `main.dart` | 功能增强 | 初始化 NicknameService |
| 2026-01-31 | `me_page.dart` | 功能增强 | 昵称可编辑：显示昵称+笔形图标，点击弹出编辑对话框，验证1-20字符 |
| 2026-01-31 | `plan_page.dart` | 功能增强 | 监听昵称变化并传递给PlanHeader，昵称与Me页面同步 |
| 2026-01-31 | `me_page.dart` | 交互优化 | 昵称改为inline编辑：点击笔形图标直接在原位显示输入框，失焦或回车自动保存 |
| 2026-01-31 | `audio_service.dart` | 功能增强 | 新增 playCatMeow() 猫咪喵叫音效(cat-meow-401729.mp3) |
| 2026-01-31 | `draggable_cat.dart` | 功能增强 | 点击猫咪触发喵叫音效并摆动尾巴 |
| 2026-01-31 | `locale_service.dart` | 新增 | 创建多语言服务：支持 en/zh/ja 三种语言，提供 tr() 全局翻译函数，持久化用户语言选择 |
| 2026-01-31 | `main.dart` | 功能增强 | 初始化 LocaleService |
| 2026-01-31 | `me_page.dart` | 功能增强 | Settings区新增Language设置入口，点击弹出语言选择浮层；菜单项文案国际化 |
| 2026-01-31 | `app_bottom_nav.dart` | 功能增强 | 底部导航标签支持多语言 |
| 2026-01-31 | `main_page.dart` | 功能增强 | 监听语言变化自动刷新UI |
| 2026-01-31 | `locale_service.dart` | 功能增强 | 新增月份(month_1~12)和四象限标题(quadrant_p0~p3_title/desc)翻译键 |
| 2026-01-31 | `plan_header.dart` | 国际化 | 昵称下方副标题使用 tr('plan_header_subtitle') |
| 2026-01-31 | `week_calendar.dart` | 国际化 | 星期名称和月份名称使用翻译键 |
| 2026-01-31 | `priority_section.dart` | 国际化 | 四象限标题使用翻译键(DO FIRST→立即执行→最優先) |
| 2026-01-31 | `plan_page.dart` | 功能增强 | 监听语言变化自动刷新日历和四象限 |
| 2026-01-31 | `add_task_sheet.dart` | 国际化 | 所有文案(New Task, Save Task, Quadrant, Repeat等)使用翻译键 |
| 2026-01-31 | `add_subtask_sheet.dart` | 国际化 | 所有文案(New Subtask, Save Subtask等)使用翻译键 |
| 2026-01-31 | `subtask_list_sheet.dart` | 国际化 | 所有文案(Subtasks, Add Subtask, No subtasks yet等)使用翻译键 |
| 2026-01-31 | `edit_task_sheet.dart` | 国际化 | 所有文案(Edit Task, Save Changes, Delete Task, Confirm Delete等)使用翻译键 |
| 2026-01-31 | `me_page.dart` | 国际化 | 设备管理浮层、修改密码浮层、头像选择浮层所有文案国际化 |
| 2026-01-31 | `login_page.dart` | 国际化 | 登录页面所有文案(Login, Password, Forgot Password, Sign Up等)使用翻译键 |
| 2026-01-31 | `register_page.dart` | 国际化 | 注册页面所有文案(Create Account, Register, Email, Password等)使用翻译键 |
| 2026-01-31 | `locale_service.dart` | 功能增强 | 新增浮层页面相关翻译键：设备管理、修改密码、头像选择、登录注册等 |
| 2026-01-31 | `statistics_page.dart` | 国际化 | 视图模块所有文案(All, Week, Month, COMPLETION RATE, Done, Todo, ONGOING TASKS, COMPLETED, UNFINISHED等)使用翻译键；监听语言变化自动刷新UI |
| 2026-01-31 | `locale_service.dart` | 功能增强 | 新增视图模块翻译键：all, all_tasks, week, month, completion_rate, ongoing_tasks等 |
| 2026-01-31 | `focus_page.dart` | 国际化 | 专注页面所有文案使用翻译键：Pomodoro, Focus History, Total Focus Time, Start Focus等；监听语言变化自动刷新UI |
| 2026-01-31 | `locale_service.dart` | 功能增强 | 新增中日文专注模块翻译键：pomodoro_completed, total_focus_time, longest_session, set_focus_duration, start_focus等 |
| 2026-01-31 | `quote_card.dart` | 样式升级 | 励志名言卡片重新设计：樱花飘落动画(12个花瓣)、多层粉色渐变背景、呼吸文字效果、光晕装饰；高度100-110px，不遮挡导航栏 |
| 2026-01-31 | `PRD_做计划APP_v2.0.md` | 文档更新 | v2.2版本更新：新增多语言系统章节(1.3)；更新四象限定义为艾森豪威尔矩阵风格；更新励志名言卡片为樱花动画效果；更新Me模块(头像20个、昵称行内编辑、语言设置)；更新音效系统详细列表；更新所有模块国际化状态；更新登录/注册页面样式说明 |
| 2026-02-04 | `locale_service.dart` | 国际化 | 新增 made_in_china 多语言配置：EN "DESIGNED WITH LOVE IN CHINA"、ZH "用心设计 · 来自中国"、JA "中国で愛を込めてデザインしました" |
| 2026-02-04 | `me_page.dart` | 功能增强 | Me页面顶部新增"Made in China"徽章：显示中国国旗SVG图标+多语言描述文案，无底色 |
| 2026-02-04 | `login_page.dart` | 功能增强 | 登录页面底部新增"Made in China"徽章：显示中国国旗SVG图标+多语言描述文案 |
| 2026-02-04 | `login_page.dart` | 布局优化 | Made in China徽章使用Spacer推至页面最底部，使用LayoutBuilder+ConstrainedBox+IntrinsicHeight确保始终贴底 |
| 2026-02-04 | `pubspec.yaml` | 依赖添加 | 新增 http (网络请求)、device_info_plus (设备信息)、uuid (UUID生成) 依赖 |
| 2026-02-04 | `api_config.dart` | 新增 | 创建 API 配置文件：Base URL (localhost:8080)、API 版本、超时时间、Token 存储键 |
| 2026-02-04 | `api_client.dart` | 新增 | 创建 API 客户端服务：统一响应结构 ApiResponse、GET/POST/PUT/DELETE 请求、幂等支持 (X-Request-Id)、Token 管理 |
| 2026-02-04 | `device_service.dart` | 新增 | 创建设备信息服务：获取设备 ID (持久化)、设备名称、平台、系统版本，对应 API 契约 deviceInfo 结构 |
| 2026-02-04 | `auth_service.dart` | 重构 | 改造为真正调用后端 API：实现 POST /api/v1/auth/register 和 /auth/login；新增 AuthData、UserInfo、Entitlement 模型；保存 accessToken/refreshToken；处理业务错误码 |
| 2026-02-04 | `register_page.dart` | 重构 | 新增昵称输入字段；注册成功后直接进入主页面；处理错误码 1004/1005/1006 的本地化错误信息；添加 Made in China 徽章 |
| 2026-02-04 | `locale_service.dart` | 国际化 | 新增翻译键：nickname、email_already_registered、nickname_contains_prohibited (中英日三语) |
| 2026-02-04 | `main.dart` | 功能增强 | 初始化 DeviceService |
| 2026-02-04 | `auth_service.dart` | 错误码完善 | 补充完整错误码映射（全局0-500、认证1001-1007、设备2001-2002、任务3001-3007、专注4001、用户5001-5002） |
| 2026-02-04 | `api_client.dart` | 错误处理优化 | 增加空响应检测、JSON解析错误捕获，区分网络错误(-1)和解析错误(-2) |
| 2026-02-04 | `register_page.dart` | 交互优化 | 注册成功后显示紧凑浮层（成功图标+提示文案+加载指示器），1.5秒后自动跳转到登录页 |
| 2026-02-04 | `locale_service.dart` | 国际化 | 新增 redirect_to_login 翻译键（中英日三语） |
| 2026-02-04 | `auth_service.dart` | BUG修复 | 注册成功时 AuthData 解析失败会抛异常导致显示网络错误，添加 try-catch 保证成功状态返回 |
| 2026-02-04 | `register_page.dart` | 调试增强 | catch 块打印详细错误信息，便于定位问题 |
| 2026-02-04 | `locale_service.dart` | 国际化完善 | 新增全量错误码翻译键（error_bad_request、error_login_failed、error_device_limit 等），覆盖全局、认证、设备、任务、专注、用户模块；新增前端校验翻译键（email_required、email_invalid、nickname_required、nickname_too_long、error_parse）；中英日三语完整支持 |
| 2026-02-04 | `auth_service.dart` | 国际化完善 | 导入 locale_service；前端校验改用 tr() 翻译键；_getErrorMessage 方法全量改用 tr() 翻译键，实现错误消息国际化 |
| 2026-02-04 | `register_page.dart` | 代码简化 | 移除冗余的 _getLocalizedError 方法，直接使用 AuthService 返回的国际化错误消息 |
| 2026-02-04 | `locale_service.dart` | 文案修改 | 找回密码浮层文案调整：中文"重置密码"→"找回密码"；英文"retrieve"→"recover"；日文"取得"→"回復" |
| 2026-02-04 | `locale_service.dart` | 国际化 | 新增找回密码功能翻译键：sending、password_reset_email_sent、check_email_for_reset_link、email_send_limit（中英日三语） |
| 2026-02-04 | `auth_service.dart` | 功能增强 | 新增 forgotPassword 方法，调用 POST /api/v1/auth/forgot-password 接口，支持邮箱校验和错误码国际化 |
| 2026-02-04 | `login_page.dart` | 功能完善 | 找回密码对话框集成真实 API：支持加载状态、错误提示、成功后显示邮件发送成功浮层；新增 _showPasswordResetSuccessDialog 方法 |
| 2026-02-04 | `auth_service.dart` | 功能增强 | 新增 DeviceInfo、DeviceListResult 模型；新增 getDevices() 方法调用 GET /api/v1/auth/devices；新增 logoutDevice() 方法调用 POST /api/v1/auth/devices/{deviceId}/logout |
| 2026-02-04 | `locale_service.dart` | 国际化 | 新增设备管理翻译键：loading_devices、refresh、no_other_devices、logout_device_success（中英日三语） |
| 2026-02-04 | `me_page.dart` | 功能完善 | _DeviceManagementSheet 改为 StatefulWidget，集成真实 API：加载设备列表、踢出设备、加载状态、错误状态、刷新功能；删除 Mock 数据和旧 _DeviceInfo 类 |
| 2026-02-04 | `me_page.dart` | 样式优化 | 设备管理浮层：设备数量（如3/10）改用红色高亮显示 |
| 2026-02-04 | `auth_service.dart` | BUG修复 | DeviceInfo.fromJson 新增 forceIsCurrent 参数；currentDevice 强制 isCurrent=true，otherDevices 强制 isCurrent=false，确保当前设备不显示 logout 按钮 |
| 2026-02-04 | `me_page.dart` | 交互优化 | 踢出设备成功后不再显示提示文案，直接从列表中删除被踢出的设备 |
| 2026-02-04 | `me_page.dart` | 功能完善 | 退出登录对话框调用后端 API POST /api/v1/auth/logout，新增加载状态和错误处理 |
| 2026-02-04 | `main.dart` | 功能增强 | 新增全局 navigatorKey 用于非 Widget 上下文导航；配置 ApiClient 的 401 回调 |
| 2026-02-04 | `api_client.dart` | 功能增强 | 新增 setOnUnauthorized 方法和 _handleUnauthorized 处理；所有请求方法（POST/GET/PUT/DELETE）检测 401 自动跳转登录页 |
| 2026-02-04 | `auth_service.dart` | 功能增强 | 新增 clearLocalAuth 方法用于 401 自动登出时清除本地认证数据 |
| 2026-02-04 | `auth_service.dart` | 功能增强 | 新增会话状态轮询：_sessionPollingTimer、startSessionPolling()、stopSessionPolling()、_checkSession()；每10秒轮询 GET /api/v1/auth/session/check；登出/401时自动停止轮询 |
| 2026-02-04 | `login_page.dart` | 功能增强 | 登录成功后调用 AuthService.startSessionPolling() 开启会话轮询 |
| 2026-02-04 | `locale_service.dart` | 国际化完善 | 日语翻译新增 'min': '分'，修复历史记录浮层分钟单位在日语环境下显示为 "min" 的问题 |
| 2026-02-04 | `focus_page.dart` | 显示优化 | _FocusHistorySheet 新增 _formatNumber 方法，防止大数字溢出屏幕：<1万显示千位分隔符(1,234)、1万~99万显示K格式(12.3K)、≥100万显示M格式(1.2M) |
| 2026-02-04 | `auth_service.dart` | 功能增强 | 新增 UserProfileResult 模型；新增 getUserProfile() 调用 GET /api/v1/user/profile；新增 fetchAndSyncUserProfile() 拉取用户信息并同步本地 NicknameService 和 AvatarService |
| 2026-02-04 | `login_page.dart` | 功能增强 | 登录成功后调用 fetchAndSyncUserProfile() 同步用户昵称和头像到本地，确保 Me 页面数据正确显示 |
| 2026-02-04 | `task_card.dart` | 交互优化 | 任务名称允许多行显示，移除 maxLines:1 和 ellipsis 截断；调整 Row 为顶部对齐，checkbox 和子任务图标加上边距与首行文字对齐 |
| 2026-02-04 | `add_task_sheet.dart` | 输入限制 | 任务名称最大长度从 100 改为 40 个字符 |
| 2026-02-04 | `edit_task_sheet.dart` | 输入限制 | 任务名称最大长度从 100 改为 40 个字符 |
| 2026-02-04 | `locale_service.dart` | 文案更新 | task_name_too_long 翻译更新：100→40（中英日三语） |
| 2026-02-04 | `add_subtask_sheet.dart` | 输入限制 | 子任务名称最大长度从 100 改为 40；主任务名称编辑增加 40 字符限制和 maxLength |
| 2026-02-04 | `subtask_list_sheet.dart` | 输入限制 | 子任务改名增加 40 字符限制；新增 _showInfoDialog 方法显示超限提示；TextField 增加 maxLength: 40 |
| 2026-02-04 | `locale_service.dart` | 文案更新 | subtask_name_too_long 翻译更新：100→40（中英日三语） |
| 2026-02-13 | `swipeable_matrix_area.dart` | 滑动卡在 50% | 改用 PageView 替代 ListView，利用自带页面吸附避免卡在中间 |
| 2026-02-13 | `swipeable_matrix_area.dart` | 重复请求 BUG | 添加 _isHandlingPageChange 防止 onPageChanged 重复触发 |
| 2026-02-13 | `plan_page.dart` | 重复请求 BUG | _handleMatrixDateChanged 增加 _isSameDay 判断，避免同日期重复触发 _fetchTasks |
| 2026-02-13 | `task_service.dart` | 接口优化 | 新增 fetchTasksByDates、TaskListByDatesResult，支持 GET /api/v1/tasks?dates= 多日期批量查询 |
| 2026-02-13 | `plan_page.dart` | 接口优化 | _fetchTasks 改用 fetchTasksByDates 单次请求替代 3 次 fetchTasksByDate |

## 相关文档

- PRD 文档: `/plan-core/docs/product/PRD_做计划APP_v2.0.md`
- 领域模型: `/plan-core/docs/architecture/领域模型设计.md`
- API 契约: `/plan-core/docs/architecture/API接口契约.md`

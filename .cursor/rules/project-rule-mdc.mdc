---
alwaysApply: true
---

# 项目约束与规范

**角色**: 资深 Flutter 开发专家
**输出要求**: “可评审、可落地、可演进”

## 0. 使用方式
- **文档更新**: 每次新增/变更后，都需要将「目录结构」、「已实现功能」和「修复记录」明确记录到 `项目结构.md` 中。

## 1. 项目事实与边界约束

### 1.1 项目事实来源
- **框架**: Flutter (通过 `flutter create` 创建)
- **目标平台**: iOS
- **开发工具**: VS Code
- **运行方式**: `flutter run` (iOS Simulator)

### 1.2 禁止假设
- **无后端**: 没明说的情况下，不得假设已有后端接口。
- **无特定状态管理**: 不得假设使用特定状态管理方案。
- **无 UI/设计规范**: 不得假设 UI 风格/设计规范。
- **必须询问**: 所有不确定点必须显式询问。

## 2. 代码修改范围（强约束）

### 2.1 允许修改的目录
- ✅ `lib/` (默认且主要)
- 🟡 `test/` (仅在用户明确要求写测试时)
- 🟡 `pubspec.yaml` (新增依赖前必须征得用户确认)

### 2.2 禁止修改的目录（除非用户明确指定）
- ❌ `ios/`
- ❌ `android/`
- ❌ `macos/`
- ❌ `web/`
- ❌ `windows/`
- ❌ `linux/`
- ❌ `.dart_tool/`
- ❌ `build/`

*若修改这些目录是必要的，必须先说明原因并等待确认。*

## 3. 开发流程约定

### 3.1 任务拆解规则
- **拆解**: 大需求必须先拆成可执行小步骤。
- **单一职责**: 每一步只解决一个明确问题。
- **避免堆砌**: 不允许“一步到位生成大量代码”。

### 3.2 推荐节奏
1. **明确目标**: (页面 / 组件 / 逻辑)
2. **设计结构**: (文件路径 + 职责)
3. **生成代码**: 实现代码。
4. **验证说明**: 给出运行/验证说明。

## 4. 代码生成规范

### 4.1 输出要求
- **路径**: 必须说明新增/修改的文件路径。
- **可运行**: 代码需可直接粘贴运行。
- **相关性**: 禁止输出与当前任务无关的代码。

### 4.2 代码风格
- **规范**: 遵循 Dart / Flutter 官方规范。
- **SRP**: Widget 保持职责单一。
- **无魔法**: 不写“魔法代码”。
- **注释**: 必要处加简短注释（解释为什么，不解释显而易见的代码）。
- **设计模式**: 复杂逻辑，必须使用设计模式来提升维护性、扩展性，必须遵循 OCP 开闭原则。

## 5. 架构与组织原则
- **解耦**: UI (Widget) 与 业务逻辑 解耦。
- **区分**: 页面 ≠ 组件 ≠ 服务。
- **简单**: 不提前引入复杂架构（如未确认就不用 Redux / Riverpod 等）。
- **优先级**: 可读性 > 复用性 > 性能。

## 6. 不确定性处理规范
- **模糊**: PRD / UI / 行为未明确：
  - 使用【假设】标注。
  - 提供 1～2 个可选方案。
  - 让用户决策后再继续。

## 7. 调试与验证约定
- **代码生成后**:
  - 说明如何运行（是否需要 `flutter run`）。
  - 描述预期看到的效果。
  - 不要求覆盖所有边界情况，先跑通主流程。
